ðŸ”¥ Stoker has been installed in namespace {{ .Release.Namespace }}.

== Next Steps ==

1. Create secrets for git authentication and gateway API access:

    kubectl create secret generic git-creds -n <namespace> \
      --from-literal=token=<your-git-token>

    kubectl create secret generic gw-api-key -n <namespace> \
      --from-literal=apiKey=<token-name>:<token-secret>

2. Apply a Stoker CR to define the git repository:

    apiVersion: stoker.io/v1alpha1
    kind: Stoker
    metadata:
      name: my-sync
    spec:
      git:
        repo: "https://github.com/your-org/ignition-config.git"
        ref: "main"
        auth:
          token:
            secretRef:
              name: git-creds
              key: token
      gateway:
        apiKeySecretRef:
          name: gw-api-key
          key: apiKey

3. Apply a SyncProfile to define file mappings:

    apiVersion: stoker.io/v1alpha1
    kind: SyncProfile
    metadata:
      name: my-profile
    spec:
      mappings:
        - source: "projects/"
          destination: "projects/"
          type: dir
          required: true
      syncPeriod: 30

4. Label the namespace for sidecar injection:

    kubectl label namespace <namespace> stoker.io/injection=enabled

5. Grant the agent RBAC in each namespace where gateways run:

    kubectl create rolebinding stoker-agent -n <namespace> \
      --clusterrole={{ include "stoker-operator.fullname" . }}-agent \
      --serviceaccount=<namespace>:<gateway-service-account>

6. Add the injection annotations to your Ignition gateway pod template:

    podAnnotations:
      stoker.io/inject: "true"
      stoker.io/cr-name: "my-sync"
      stoker.io/sync-profile: "my-profile"
      # stoker.io/gateway-name: "my-gw"  # optional â€” defaults to app.kubernetes.io/name label or pod name

{{- if and .Values.webhook.enabled .Values.certManager.enabled }}

== cert-manager ==

TLS certificates for sidecar injection are managed by cert-manager.
Ensure cert-manager is installed: https://cert-manager.io/docs/installation/
{{- end }}

Quickstart guide: https://github.com/ia-eknorr/stoker-operator/blob/main/docs/quickstart.md
Documentation:    https://github.com/ia-eknorr/stoker-operator
